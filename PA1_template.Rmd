### 5/13/14 ###
# Reproducible Research: Peer Assessment 1


## Loading and preprocessing the data

```{r loading_data}
input <- read.table("activity.csv",sep=",",header=T)
head(input)
table(input$date)
```

## What is mean total number of steps taken per day?
``` {r mean_total_steps}
hist(input$steps,col="red",xlab="Number of steps",main="Histogram of steps taken")
require(plyr)
results <- ddply(input,"date",function(x) {
	data.frame(mean.steps=mean(x$steps,na.rm=T),median.steps=median(x$steps,na.rm=T))
})
head(results)
```

## What is the average daily activity pattern?
``` {r average_daily_activity }
out <- ddply(input,"interval",function(x) {
	data.frame(mean.steps=mean(x$steps,na.rm=T))
})
head(out)
plot(out$interval,out$mean.steps,type="l")
subset(out,mean.steps==max(mean.steps))

```

## Imputing missing values
``` {r missing_values}
sum(!complete.cases(input))
#library(reshape2)
#input2 <- dcast(input,interval~date,value.var="steps")
#rownames(input2) <- input2$interval
#input2 <-subset(input2,select=-interval)
#head(input2)
#input2.imputed <- data.frame(impute.knn(as.matrix(input2),k=20,colmax=1)$data,stringsAsFactors=F)
input2 <- head(merge(input,out,by="interval"),n=20)
for (i in 1:dim(input2)[1]) {
	input2[i,"steps"] = ifelse(is.na(input2[i,"steps"]),input2[i,"mean.steps"],input2[i,"steps"])
}
input3 <- data.frame(t(apply(as.matrix(input2),1,function(x) {
	x[2]=ifelse(is.na(x[2]),x[4],x[2])
	return(x)
})),check.names=F)

```

## Are there differences in activity patterns between weekdays and weekends?
